<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" href="data:image/png;base64,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">
<title>BC CallNotes App ‚Äî Phone Call Notebook</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-deep: #0f1117;
    --bg-sidebar: #161822;
    --bg-main: #1a1d2b;
    --bg-card: #1f2335;
    --bg-input: #252840;
    --border: #2a2d42;
    --border-light: #353856;
    --text-primary: #e4e6f0;
    --text-secondary: #8b8fa8;
    --text-muted: #5c6080;
    --accent: #6c8cff;
    --accent-glow: rgba(108, 140, 255, 0.15);
    --accent-hover: #8aa4ff;
    --green: #5ae0a0;
    --green-glow: rgba(90, 224, 160, 0.12);
    --red: #ff6b7a;
    --red-glow: rgba(255, 107, 122, 0.12);
    --amber: #f0b865;
    --amber-glow: rgba(240, 184, 101, 0.1);
    --purple: #b08cff;
    --sidebar-w: 260px;
    --topbar-h: 56px;
  }


  /* Light theme */
  body.light-theme {
    --bg-deep: #f0f2f5;
    --bg-sidebar: #ffffff;
    --bg-main: #f8f9fb;
    --bg-card: #ffffff;
    --bg-input: #e8eaf0;
    --border: #d4d7e0;
    --border-light: #c0c4d0;
    --text-primary: #1a1d2b;
    --text-secondary: #555a70;
    --text-muted: #8b8fa8;
    --accent: #4a6ef5;
    --accent-glow: rgba(74, 110, 245, 0.12);
    --accent-hover: #3a5ee0;
    --green: #2ab87a;
    --green-glow: rgba(42, 184, 122, 0.1);
    --red: #e5475b;
    --red-glow: rgba(229, 71, 91, 0.1);
    --amber: #d4952e;
    --amber-glow: rgba(212, 149, 46, 0.1);
    --purple: #7c5ccf;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg-deep);
    color: var(--text-primary);
    height: 100vh;
    overflow: hidden;
    display: flex;
    transition: background 0.3s, color 0.3s;
  }

  /* ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ */
  .sidebar {
    width: var(--sidebar-w);
    min-width: var(--sidebar-w);
    background: var(--bg-sidebar);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    height: 100vh;
    z-index: 10;
  }

  .sidebar-brand {
    padding: 16px 16px 14px;
    border-bottom: 1px solid var(--border);
  }

  .sidebar-brand h1 {
    font-family: 'Playfair Display', serif;
    font-size: 20px;
    font-weight: 800;
    background: linear-gradient(135deg, var(--accent), var(--purple));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: -0.5px;
    line-height: 1.2;
    white-space: nowrap;
  }

  .sidebar-brand p {
    font-size: 10px;
    color: var(--text-muted);
    margin-top: 1px;
    letter-spacing: 1.2px;
    text-transform: uppercase;
    white-space: nowrap;
  }

  /* Dashboard button */
  .dashboard-btn {
    margin: 12px 10px 4px;
    padding: 10px 14px;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 13.5px;
    font-weight: 600;
    color: var(--amber);
    background: var(--amber-glow);
    border: 1px solid rgba(240, 184, 101, 0.15);
    font-family: 'DM Sans', sans-serif;
    transition: all 0.15s;
  }

  .dashboard-btn:hover {
    background: rgba(240, 184, 101, 0.18);
    border-color: rgba(240, 184, 101, 0.3);
  }

  .dashboard-btn.active {
    background: rgba(240, 184, 101, 0.22);
    border-color: var(--amber);
  }

  .dashboard-btn .badge {
    margin-left: auto;
    background: var(--amber);
    color: var(--bg-deep);
    font-size: 11px;
    font-weight: 700;
    padding: 1px 7px;
    border-radius: 10px;
    font-family: 'JetBrains Mono', monospace;
  }

  .sidebar-section-label {
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 1.8px;
    text-transform: uppercase;
    color: var(--text-muted);
    padding: 14px 20px 8px;
  }

  .folder-list {
    flex: 1;
    overflow-y: auto;
    padding: 4px 10px;
  }

  .folder-list::-webkit-scrollbar { width: 4px; }
  .folder-list::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

  .folder-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 9px 12px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.15s ease;
    font-size: 13.5px;
    font-weight: 500;
    color: var(--text-secondary);
    position: relative;
  }

  .folder-item:hover {
    background: rgba(108, 140, 255, 0.06);
    color: var(--text-primary);
  }

  .folder-item.active {
    background: var(--accent-glow);
    color: var(--accent);
  }

  .folder-item .dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .folder-item .count {
    margin-left: auto;
    font-size: 11px;
    background: var(--bg-input);
    padding: 1px 7px;
    border-radius: 10px;
    color: var(--text-muted);
    font-family: 'JetBrains Mono', monospace;
  }

  .folder-item.active .count {
    background: rgba(108, 140, 255, 0.15);
    color: var(--accent);
  }

  .folder-item .delete-folder {
    display: none;
    position: absolute;
    right: 8px;
    background: none;
    border: none;
    color: var(--red);
    cursor: pointer;
    font-size: 14px;
    padding: 2px 4px;
    border-radius: 4px;
    opacity: 0.6;
  }

  .folder-item:hover .delete-folder { display: block; }
  .folder-item:hover .count { display: none; }
  .folder-item .delete-folder:hover { opacity: 1; }

  .add-folder-btn {
    margin: 8px 10px 16px;
    padding: 9px 12px;
    background: transparent;
    border: 1px dashed var(--border-light);
    border-radius: 8px;
    color: var(--text-muted);
    cursor: pointer;
    font-size: 13px;
    font-family: 'DM Sans', sans-serif;
    transition: all 0.15s ease;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .add-folder-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
    background: var(--accent-glow);
  }

  .sidebar-footer {
    padding: 10px 12px;
    border-top: 1px solid var(--border);
    font-size: 11px;
    color: var(--text-muted);
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .sidebar-footer > span { padding: 0 4px; }

  .sidebar-backup-status {
    padding: 0 16px 10px;
    font-size: 10px;
    color: var(--text-muted);
    font-family: 'JetBrains Mono', monospace;
  }

  .sidebar-backup-status .last-backup {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .sidebar-backup-status .backup-warn {
    color: var(--amber);
    cursor: pointer;
  }

  .sidebar-backup-status .backup-ok {
    color: var(--green);
  }

  .export-btn {
    background: none;
    border: 1px solid var(--border);
    color: var(--text-secondary);
    padding: 4px 10px;
    border-radius: 6px;
    font-size: 11px;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    transition: all 0.15s;
  }
  .export-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
  }

  /* ‚îÄ‚îÄ Main Area ‚îÄ‚îÄ */
  .main-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-width: 0;
  }

  .topbar {
    height: var(--topbar-h);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    padding: 0 24px;
    gap: 16px;
    background: var(--bg-main);
    flex-shrink: 0;
  }

  .topbar-folder-name {
    font-weight: 600;
    font-size: 16px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .topbar-folder-name .dot {
    width: 10px; height: 10px;
    border-radius: 50%;
  }


  /* Auto-save indicator */
  .save-indicator {
    font-size: 11px;
    font-family: 'JetBrains Mono', monospace;
    color: var(--green);
    opacity: 0;
    transition: opacity 0.3s;
    white-space: nowrap;
  }
  .save-indicator.show { opacity: 1; }

  .topbar-search {
    margin-left: auto;
    position: relative;
  }

  .topbar-search input {
    background: var(--bg-input);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 7px 14px 7px 34px;
    color: var(--text-primary);
    font-size: 13px;
    font-family: 'DM Sans', sans-serif;
    width: 220px;
    transition: all 0.2s;
    outline: none;
  }

  .topbar-search input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-glow);
    width: 280px;
  }

  .topbar-search input::placeholder { color: var(--text-muted); }

  .topbar-search svg {
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
  }


  /* Global search results dropdown */
  .global-search-results {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    margin-top: 4px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 10px;
    max-height: 360px;
    overflow-y: auto;
    z-index: 50;
    box-shadow: 0 12px 40px rgba(0,0,0,0.4);
    display: none;
  }
  .global-search-results.show { display: block; }
  .search-result-item {
    padding: 10px 14px; cursor: pointer; border-bottom: 1px solid var(--border); transition: background 0.1s;
  }
  .search-result-item:hover { background: var(--accent-glow); }
  .search-result-item:last-child { border-bottom: none; }
  .search-result-title { font-size: 13px; font-weight: 600; margin-bottom: 2px; }
  .search-result-snippet { font-size: 11px; color: var(--text-muted); }
  .search-result-meta { font-size: 10px; color: var(--text-muted); margin-top: 3px; font-family: 'JetBrains Mono', monospace; }
  .search-highlight { background: rgba(240, 184, 101, 0.3); border-radius: 2px; padding: 0 1px; }

  .new-note-btn {
    background: var(--accent);
    border: none;
    border-radius: 8px;
    color: #fff;
    padding: 8px 16px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.15s;
    white-space: nowrap;
  }

  .new-note-btn:hover {
    background: var(--accent-hover);
    transform: translateY(-1px);
    box-shadow: 0 4px 16px rgba(108, 140, 255, 0.3);
  }

  /* ‚îÄ‚îÄ Content ‚îÄ‚îÄ */
  .content-area {
    flex: 1;
    display: flex;
    overflow: hidden;
  }

  /* ‚îÄ‚îÄ Notes List ‚îÄ‚îÄ */
  .notes-list {
    width: 320px;
    min-width: 320px;
    border-right: 1px solid var(--border);
    overflow-y: auto;
    background: var(--bg-main);
  }

  .notes-list::-webkit-scrollbar { width: 4px; }
  .notes-list::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

  .note-preview {
    padding: 14px 18px;
    border-bottom: 1px solid var(--border);
    cursor: pointer;
    transition: all 0.12s;
    position: relative;
  }

  .note-preview:hover { background: rgba(108, 140, 255, 0.04); }

  .note-preview.active {
    background: var(--accent-glow);
    border-left: 3px solid var(--accent);
  }

  .note-preview-title {
    font-weight: 600;
    font-size: 13.5px;
    margin-bottom: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .note-preview-snippet {
    font-size: 12px;
    color: var(--text-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 6px;
  }

  .note-preview-meta {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 11px;
    color: var(--text-muted);
    font-family: 'JetBrains Mono', monospace;
  }

  .note-preview-tasks {
    display: inline-flex;
    align-items: center;
    gap: 3px;
    color: var(--amber);
    font-size: 11px;
  }




  /* Template dropdown */
  .template-dropdown { position: relative; display: inline-block; }
  .template-btn {
    background: var(--bg-input); border: 1px solid var(--border); border-radius: 8px;
    color: var(--text-secondary); padding: 8px 12px; font-size: 13px; cursor: pointer;
    font-family: 'DM Sans', sans-serif; display: flex; align-items: center; gap: 6px; transition: all 0.15s; white-space: nowrap;
  }
  .template-btn:hover { border-color: var(--accent); color: var(--accent); }
  .template-menu {
    position: absolute; top: 100%; right: 0; margin-top: 4px; background: var(--bg-card);
    border: 1px solid var(--border); border-radius: 10px; min-width: 220px; z-index: 50;
    box-shadow: 0 8px 30px rgba(0,0,0,0.4); display: none; overflow: hidden;
  }
  .template-menu.show { display: block; }
  .template-menu-item { padding: 10px 16px; cursor: pointer; border-bottom: 1px solid var(--border); transition: background 0.1s; font-size: 13px; }
  .template-menu-item:hover { background: var(--accent-glow); }
  .template-menu-item:last-child { border-bottom: none; }
  .template-menu-item .tmpl-name { font-weight: 600; }
  .template-menu-item .tmpl-desc { font-size: 11px; color: var(--text-muted); margin-top: 2px; }

  .pin-star { color: var(--amber); font-size: 12px; flex-shrink: 0; }

  .note-tag-badge { font-size: 10px; padding: 1px 6px; border-radius: 4px; font-weight: 600; }

  .note-preview .note-actions-row { display: none; position: absolute; top: 10px; right: 10px; gap: 4px; }
  .note-preview:hover .note-actions-row { display: flex; }
  .note-action-sm {
    background: var(--bg-input); border: 1px solid var(--border); color: var(--text-muted);
    cursor: pointer; font-size: 11px; padding: 2px 6px; border-radius: 4px; transition: all 0.1s;
  }
  .note-action-sm.pin-btn:hover, .note-action-sm.pin-btn.pinned { color: var(--amber); border-color: var(--amber); }
  .note-action-sm.del-btn:hover { color: var(--red); border-color: var(--red); background: var(--red-glow); }

  /* Tags in editor */
  .editor-tags-row { display: flex; align-items: center; gap: 6px; margin-top: 8px; flex-wrap: wrap; }
  .tag-chip { font-size: 11px; padding: 2px 8px; border-radius: 4px; font-weight: 600; cursor: pointer; transition: all 0.12s; border: 1px solid transparent; }
  .tag-chip:hover { opacity: 0.8; }
  .tag-chip.active { border-color: currentColor; }

  /* Voice mic button */
  .line-mic-btn {
    flex-shrink: 0; background: none; border: 1px solid var(--border); border-radius: 5px;
    color: var(--text-muted); cursor: pointer; font-size: 13px; padding: 3px 6px;
    transition: all 0.12s; opacity: 0; margin-top: 4px;
  }
  .note-line:hover .line-mic-btn { opacity: 1; }
  .line-mic-btn:hover { border-color: var(--red); color: var(--red); background: var(--red-glow); }
  .line-mic-btn.recording {
    opacity: 1; border-color: var(--red); color: var(--red); background: var(--red-glow);
    animation: pulse-mic 1s ease-in-out infinite;
  }
  @keyframes pulse-mic {
    0%, 100% { box-shadow: 0 0 0 0 rgba(255, 107, 122, 0.4); }
    50% { box-shadow: 0 0 0 6px rgba(255, 107, 122, 0); }
  }

  /* Theme toggle */
  .theme-toggle {
    background: none; border: 1px solid var(--border); color: var(--text-secondary);
    padding: 4px 10px; border-radius: 6px; font-size: 11px; cursor: pointer;
    font-family: 'DM Sans', sans-serif; transition: all 0.15s;
  }
  .theme-toggle:hover { border-color: var(--accent); color: var(--accent); }

  /* ‚îÄ‚îÄ Editor ‚îÄ‚îÄ */
  .editor-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: var(--bg-deep);
    min-width: 0;
  }

  .editor-header {
    padding: 18px 28px 12px;
    border-bottom: 1px solid var(--border);
    background: var(--bg-main);
  }

  .editor-title-input {
    width: 100%;
    background: none;
    border: none;
    color: var(--text-primary);
    font-size: 20px;
    font-weight: 700;
    font-family: 'DM Sans', sans-serif;
    outline: none;
    margin-bottom: 6px;
  }

  .editor-title-input::placeholder { color: var(--text-muted); }

  .editor-meta {
    display: flex;
    align-items: center;
    gap: 16px;
    font-size: 12px;
    color: var(--text-muted);
    font-family: 'JetBrains Mono', monospace;
  }

  .editor-meta .tag {
    background: var(--accent-glow);
    color: var(--accent);
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 11px;
  }

  .caller-input-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
  }

  .caller-input-row label {
    font-size: 12px;
    color: var(--text-muted);
    white-space: nowrap;
  }

  .caller-input {
    background: var(--bg-input);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 4px 10px;
    color: var(--text-primary);
    font-size: 12px;
    font-family: 'DM Sans', sans-serif;
    outline: none;
    flex: 1;
    max-width: 300px;
  }

  .caller-input:focus { border-color: var(--accent); }

  .editor-body {
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
  }

  .editor-body::-webkit-scrollbar { width: 6px; }
  .editor-body::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

  /* ‚îÄ‚îÄ Line-by-line note editor ‚îÄ‚îÄ */
  .note-lines-area {
    flex: 1;
    padding: 16px 28px;
  }

  .note-line {
    display: flex;
    align-items: flex-start;
    gap: 8px;
    margin-bottom: 2px;
    position: relative;
    border-radius: 6px;
    padding: 4px 6px;
    transition: background 0.1s;
  }

  .note-line:hover {
    background: rgba(255,255,255,0.02);
  }

  .note-line-number {
    font-size: 11px;
    color: var(--text-muted);
    font-family: 'JetBrains Mono', monospace;
    width: 22px;
    text-align: right;
    padding-top: 7px;
    flex-shrink: 0;
    opacity: 0.5;
    user-select: none;
  }

  .note-line-input {
    flex: 1;
    background: none;
    border: none;
    color: var(--text-primary);
    font-size: 14px;
    line-height: 1.7;
    font-family: 'DM Sans', sans-serif;
    outline: none;
    padding: 4px 0;
    min-width: 0;
  }

  .note-line-input::placeholder { color: var(--text-muted); opacity: 0.4; }

  .note-line-input.has-task {
    border-bottom: 1px dashed rgba(240, 184, 101, 0.25);
  }

  .line-task-btn {
    flex-shrink: 0;
    background: none;
    border: 1px solid var(--border);
    border-radius: 5px;
    color: var(--text-muted);
    cursor: pointer;
    font-size: 11px;
    padding: 3px 6px;
    font-family: 'DM Sans', sans-serif;
    transition: all 0.12s;
    opacity: 0;
    margin-top: 4px;
    white-space: nowrap;
  }

  .note-line:hover .line-task-btn { opacity: 1; }

  .line-task-btn:hover {
    border-color: var(--amber);
    color: var(--amber);
    background: var(--amber-glow);
  }

  .line-task-btn.has-task {
    opacity: 1;
    border-color: var(--amber);
    color: var(--amber);
    background: var(--amber-glow);
  }

  .line-task-indicator {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-top: 2px;
    padding: 3px 8px;
    background: var(--amber-glow);
    border-radius: 4px;
    font-size: 11px;
    color: var(--amber);
    flex-shrink: 0;
  }

  .line-task-indicator .assignee { font-weight: 600; }
  .line-task-indicator .due { font-family: 'JetBrains Mono', monospace; font-size: 10px; }

  .line-task-indicator .remove-task {
    cursor: pointer;
    color: var(--red);
    margin-left: 4px;
    opacity: 0.6;
  }
  .line-task-indicator .remove-task:hover { opacity: 1; }

  .line-task-indicator .email-link {
    cursor: pointer;
    color: var(--accent);
    text-decoration: none;
    margin-left: 2px;
  }
  .line-task-indicator .email-link:hover { color: var(--accent-hover); }

  .line-task-complete {
    cursor: pointer;
    margin-left: 2px;
    opacity: 0.7;
  }
  .line-task-complete:hover { opacity: 1; }

  /* ‚îÄ‚îÄ Dashboard View ‚îÄ‚îÄ */
  .dashboard-view {
    flex: 1;
    overflow-y: auto;
    padding: 28px 36px;
    display: none;
  }

  .dashboard-view.active { display: block; }

  .dashboard-view::-webkit-scrollbar { width: 6px; }
  .dashboard-view::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

  .dash-header {
    margin-bottom: 28px;
  }

  .dash-header h2 {
    font-family: 'Playfair Display', serif;
    font-size: 26px;
    font-weight: 800;
    margin-bottom: 6px;
  }

  .dash-header p {
    color: var(--text-muted);
    font-size: 14px;
  }

  .dash-stats {
    display: flex;
    gap: 16px;
    margin-bottom: 28px;
  }

  .dash-stat-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 18px 22px;
    flex: 1;
    min-width: 0;
  }

  .dash-stat-card .label {
    font-size: 12px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 6px;
  }

  .dash-stat-card .value {
    font-size: 28px;
    font-weight: 700;
    font-family: 'JetBrains Mono', monospace;
  }

  .dash-stat-card.overdue .value { color: var(--red); }
  .dash-stat-card.due-soon .value { color: var(--amber); }
  .dash-stat-card.upcoming .value { color: var(--accent); }
  .dash-stat-card.completed .value { color: var(--green); }

  .dash-section-title {
    font-size: 14px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-secondary);
    margin: 24px 0 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .dash-section-title .dot-ind {
    width: 8px; height: 8px;
    border-radius: 50%;
  }

  .dash-filter-row {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .dash-filter-btn {
    background: var(--bg-input);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--text-secondary);
    padding: 5px 12px;
    font-size: 12px;
    font-family: 'DM Sans', sans-serif;
    cursor: pointer;
    transition: all 0.12s;
  }

  .dash-filter-btn:hover { border-color: var(--accent); color: var(--text-primary); }
  .dash-filter-btn.active { border-color: var(--accent); color: var(--accent); background: var(--accent-glow); }

  .task-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 18px;
    margin-bottom: 10px;
    display: flex;
    align-items: flex-start;
    gap: 14px;
    transition: all 0.12s;
    animation: fadeIn 0.2s ease;
  }

  .task-card:hover {
    border-color: var(--border-light);
    background: rgba(31, 35, 53, 0.8);
  }

  .task-card.overdue { border-left: 3px solid var(--red); }
  .task-card.due-soon { border-left: 3px solid var(--amber); }
  .task-card.upcoming-task { border-left: 3px solid var(--accent); }
  .task-card.completed-task { border-left: 3px solid var(--green); opacity: 0.6; }

  .task-check {
    width: 20px; height: 20px;
    border-radius: 50%;
    border: 2px solid var(--border-light);
    cursor: pointer;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
    margin-top: 2px;
  }

  .task-check:hover { border-color: var(--green); background: var(--green-glow); }
  .task-check.done { border-color: var(--green); background: var(--green); }
  .task-check.done::after { content: '‚úì'; color: var(--bg-deep); font-size: 12px; font-weight: 700; }

  .task-info { flex: 1; min-width: 0; }

  .task-text {
    font-size: 13.5px;
    font-weight: 500;
    margin-bottom: 4px;
    line-height: 1.4;
  }

  .task-text.done-text { text-decoration: line-through; opacity: 0.5; }

  .task-meta-row {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 11px;
    color: var(--text-muted);
    flex-wrap: wrap;
  }

  .task-assignee {
    display: flex; align-items: center; gap: 4px;
    color: var(--purple);
    font-weight: 600;
  }

  .task-due {
    font-family: 'JetBrains Mono', monospace;
  }

  .task-due.overdue-text { color: var(--red); font-weight: 600; }
  .task-due.due-soon-text { color: var(--amber); }

  .task-from-note {
    color: var(--text-muted);
    cursor: pointer;
  }
  .task-from-note:hover { color: var(--accent); text-decoration: underline; }

  .task-actions {
    display: flex;
    gap: 6px;
    flex-shrink: 0;
    margin-top: 2px;
  }

  .task-action-btn {
    background: var(--bg-input);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--text-muted);
    padding: 4px 8px;
    font-size: 11px;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    transition: all 0.12s;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .task-action-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
  }

  .task-action-btn.email-btn:hover {
    border-color: var(--green);
    color: var(--green);
  }

  .no-tasks-msg {
    color: var(--text-muted);
    font-size: 13px;
    padding: 20px;
    text-align: center;
    background: var(--bg-card);
    border-radius: 10px;
    border: 1px dashed var(--border);
  }

  /* ‚îÄ‚îÄ Empty States ‚îÄ‚îÄ */
  .empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: var(--text-muted);
    gap: 12px;
    padding: 40px;
    text-align: center;
  }

  .empty-state svg { opacity: 0.3; }
  .empty-state p { font-size: 14px; }
  .empty-state .hint { font-size: 12px; opacity: 0.6; }

  /* ‚îÄ‚îÄ Modal Overlay ‚îÄ‚îÄ */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 100;
  }

  .modal-overlay.show { display: flex; }

  .modal {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 28px;
    width: 440px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  }

  .modal h2 {
    font-size: 18px;
    margin-bottom: 16px;
  }

  .modal label {
    display: block;
    font-size: 12px;
    color: var(--text-secondary);
    margin-bottom: 4px;
    margin-top: 12px;
  }

  .modal label:first-of-type { margin-top: 0; }

  .modal input, .modal select {
    width: 100%;
    padding: 9px 14px;
    background: var(--bg-input);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text-primary);
    font-size: 14px;
    font-family: 'DM Sans', sans-serif;
    outline: none;
  }

  .modal input:focus, .modal select:focus { border-color: var(--accent); }

  .modal-colors {
    display: flex;
    gap: 8px;
    margin: 12px 0 20px;
  }

  .modal-colors .color-opt {
    width: 28px; height: 28px;
    border-radius: 50%;
    cursor: pointer;
    border: 3px solid transparent;
    transition: all 0.15s;
  }

  .modal-colors .color-opt:hover { transform: scale(1.15); }
  .modal-colors .color-opt.selected { border-color: #fff; transform: scale(1.15); }

  .modal-actions {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
    margin-top: 20px;
  }

  .modal-actions button {
    padding: 8px 18px;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    border: none;
    transition: all 0.15s;
  }

  .btn-cancel {
    background: var(--bg-input);
    color: var(--text-secondary);
  }
  .btn-cancel:hover { background: var(--border); }

  .btn-primary {
    background: var(--accent);
    color: #fff;
  }
  .btn-primary:hover { background: var(--accent-hover); }

  .task-line-preview {
    background: var(--bg-input);
    border-radius: 6px;
    padding: 8px 12px;
    margin-bottom: 12px;
    font-size: 13px;
    color: var(--text-secondary);
    border-left: 3px solid var(--amber);
  }

  /* ‚îÄ‚îÄ Animations ‚îÄ‚îÄ */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(6px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .note-preview { animation: fadeIn 0.2s ease; }

  /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
  @media (max-width: 1100px) {
    .dash-stats { flex-wrap: wrap; }
    .dash-stat-card { min-width: 120px; }
  }

  @media (max-width: 900px) {
    .notes-list { width: 240px; min-width: 240px; }
  }

  /* ‚îÄ‚îÄ Mobile hamburger button ‚îÄ‚îÄ */
  .mobile-hamburger {
    display: none;
    background: none;
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text-primary);
    padding: 6px 10px;
    font-size: 18px;
    cursor: pointer;
    transition: all 0.15s;
    flex-shrink: 0;
  }
  .mobile-hamburger:hover { border-color: var(--accent); color: var(--accent); }

  /* Mobile back button */
  .mobile-back-btn {
    display: none;
    background: none;
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text-secondary);
    padding: 6px 10px;
    font-size: 13px;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    transition: all 0.15s;
    flex-shrink: 0;
    white-space: nowrap;
  }
  .mobile-back-btn:hover { border-color: var(--accent); color: var(--accent); }

  /* Sidebar overlay for mobile */
  .sidebar-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    z-index: 9;
  }
  .sidebar-overlay.show { display: block; }

  @media (max-width: 768px) {
    body { flex-direction: column; }

    .mobile-hamburger { display: flex; }

    /* Sidebar becomes a slide-out drawer */
    .sidebar {
      position: fixed;
      left: -280px;
      top: 0;
      width: 280px;
      min-width: 280px;
      height: 100vh;
      z-index: 20;
      transition: left 0.3s ease;
      box-shadow: none;
    }
    .sidebar.open {
      left: 0;
      box-shadow: 4px 0 24px rgba(0,0,0,0.3);
    }

    /* Main area takes full width */
    .main-area {
      width: 100%;
      height: 100vh;
    }

    /* Topbar adjustments */
    .topbar {
      padding: 0 12px;
      gap: 8px;
      flex-wrap: nowrap;
      height: auto;
      min-height: var(--topbar-h);
      padding-top: 8px;
      padding-bottom: 8px;
    }

    .topbar-folder-name {
      font-size: 14px;
      min-width: 0;
      overflow: hidden;
    }
    .topbar-folder-name #topbarTitle {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .save-indicator { display: none; }

    .topbar-search {
      flex: 1;
      min-width: 0;
      margin-left: 0;
    }
    .topbar-search input {
      width: 100% !important;
      font-size: 14px;
      padding: 8px 14px 8px 34px;
    }
    .topbar-search input:focus { width: 100% !important; }

    .template-dropdown { display: none; }

    .new-note-btn {
      padding: 8px 12px;
      font-size: 12px;
      white-space: nowrap;
    }
    .new-note-btn span { display: none; }

    /* Content area: mobile panel navigation */
    .content-area {
      flex-direction: column;
      position: relative;
    }

    /* Notes list: full width panel */
    .notes-list {
      width: 100% !important;
      min-width: 100% !important;
      border-right: none;
      border-bottom: 1px solid var(--border);
      max-height: 100%;
      flex: 1;
    }

    /* When editor is active on mobile, hide notes list */
    .notes-list.mobile-hidden { display: none !important; }

    /* Editor: full screen on mobile */
    .editor-area {
      width: 100%;
      flex: 1;
    }
    .editor-area.mobile-hidden { display: none !important; }

    .mobile-back-btn.show { display: flex; }

    /* Editor header adjustments */
    .editor-header {
      padding: 12px 16px 10px;
    }
    .editor-title-input {
      font-size: 17px;
    }
    .caller-input-row {
      flex-wrap: wrap;
    }
    .caller-input {
      max-width: 100%;
      flex: 1;
    }
    .editor-tags-row {
      gap: 4px;
    }
    .tag-chip {
      font-size: 10px;
      padding: 2px 6px;
    }

    /* Note lines area */
    .note-lines-area {
      padding: 12px 14px;
    }
    .note-line {
      gap: 4px;
      padding: 4px 2px;
    }
    .note-line-number {
      width: 18px;
      font-size: 10px;
    }
    .note-line-input {
      font-size: 15px;
      padding: 6px 0;
    }

    /* Always show mic and task buttons on mobile (no hover) */
    .line-mic-btn { opacity: 1 !important; padding: 6px 8px; font-size: 14px; }
    .line-task-btn { opacity: 1 !important; padding: 6px 8px; font-size: 12px; }

    /* Note previews */
    .note-preview {
      padding: 12px 14px;
    }
    .note-actions-row {
      display: flex !important;
      position: static !important;
      margin-top: 6px;
      gap: 6px;
    }
    .note-action-sm {
      padding: 4px 10px;
      font-size: 12px;
    }

    /* Dashboard */
    .dashboard-view {
      padding: 16px;
    }
    .dash-stats {
      flex-wrap: wrap;
      gap: 8px;
    }
    .dash-stat-card {
      min-width: calc(50% - 4px);
      padding: 12px 14px;
    }
    .dash-stat-card .value { font-size: 22px; }
    .dash-filter-row { gap: 6px; }
    .dash-filter-btn { padding: 6px 10px; font-size: 11px; }

    .task-card {
      padding: 12px;
      gap: 10px;
      flex-wrap: wrap;
    }
    .task-actions {
      width: 100%;
      justify-content: flex-end;
      margin-top: 4px;
    }

    /* Sidebar footer on mobile */
    .sidebar-footer {
      padding: 10px;
    }
    .sidebar-footer > div {
      flex-wrap: wrap;
    }

    /* Modal on mobile */
    .modal {
      width: calc(100vw - 32px);
      max-height: 90vh;
      overflow-y: auto;
      margin: 16px;
    }

    /* Global search results */
    .global-search-results {
      position: fixed;
      top: auto;
      left: 12px;
      right: 12px;
      max-height: 50vh;
    }
  }

  /* Extra small screens */
  @media (max-width: 400px) {
    .topbar { gap: 6px; padding: 0 8px; padding-top: 6px; padding-bottom: 6px; }
    .new-note-btn { padding: 6px 10px; }
    .dash-stat-card { min-width: 100%; }
  }
</style>
</head>
<body>

<!-- Sidebar -->
<aside class="sidebar">
  <div class="sidebar-brand">
    <div style="display:flex; align-items:center; gap:12px;">
      <img src="data:image/png;base64,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" alt="" style="width:40px; height:40px; border-radius:9px; box-shadow: 0 2px 12px rgba(108,140,255,0.3); flex-shrink:0;">
      <div style="min-width:0;">
        <h1>BC CallNotes</h1>
        <p>Phone Call Notebook</p>
      </div>
    </div>
  </div>

  <button class="dashboard-btn" id="dashboardBtn" onclick="openDashboard()">
    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="5" height="5" rx="1"/><rect x="9" y="2" width="5" height="5" rx="1"/><rect x="2" y="9" width="5" height="5" rx="1"/><rect x="9" y="9" width="5" height="5" rx="1"/></svg>
    Task Dashboard
    <span class="badge" id="dashBadge">0</span>
  </button>

  <div class="sidebar-section-label">Folders</div>

  <div class="folder-list" id="folderList"></div>

  <button class="add-folder-btn" onclick="openAddFolderModal()">
    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><line x1="7" y1="2" x2="7" y2="12"/><line x1="2" y1="7" x2="12" y2="7"/></svg>
    New Folder
  </button>

  <div class="sidebar-footer">
    <span id="totalNotesCount">0 notes</span>
    <div style="display:flex; gap:6px;">
      <button class="export-btn" onclick="exportAllNotes()" title="Export as readable text">Export</button>
      <button class="export-btn" onclick="backupData()" title="Save full backup (JSON)" style="color:var(--green); border-color:var(--green);">üíæ Backup</button>
      <button class="export-btn" onclick="document.getElementById('restoreInput').click()" title="Restore from backup">üìÇ Restore</button>
      <input type="file" id="restoreInput" accept=".json" style="display:none" onchange="restoreData(event)">
      <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="Toggle light/dark mode">‚òÄÔ∏è Light</button>
    </div>
  </div>
  <div class="sidebar-backup-status" id="backupStatus"></div>
</aside>
<div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleMobileSidebar()"></div>

<!-- Main -->
<div class="main-area">
  <div class="topbar">
    <button class="mobile-hamburger" id="mobileHamburger" onclick="toggleMobileSidebar()">‚ò∞</button>
    <button class="mobile-back-btn" id="mobileBackBtn" onclick="mobileGoBack()">‚Üê Back</button>
    <div class="topbar-folder-name" id="topbarFolderName">
      <span class="dot" id="topbarDot"></span>
      <span id="topbarTitle">Select a folder</span>
    </div>
    <span class="save-indicator" id="saveIndicator">‚úì Saved</span>
    <div class="topbar-search">
      <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><circle cx="7" cy="7" r="5"/><line x1="11" y1="11" x2="15" y2="15"/></svg>
      <input type="text" placeholder="Search all notes‚Ä¶" id="searchInput" oninput="onGlobalSearch()" onfocus="onGlobalSearch()" onblur="setTimeout(()=>hideGlobalSearch(),200)">
      <div class="global-search-results" id="globalSearchResults"></div>
    </div>
    <div class="template-dropdown">
      <button class="template-btn" onclick="toggleTemplateMenu()" title="Create from template">üìã Template ‚ñæ</button>
      <div class="template-menu" id="templateMenu">
        <div class="template-menu-item" onclick="createFromTemplate('client')"><div class="tmpl-name">üìû Client Call</div><div class="tmpl-desc">Pre-filled for client conversations</div></div>
        <div class="template-menu-item" onclick="createFromTemplate('support')"><div class="tmpl-name">üéß Support Ticket</div><div class="tmpl-desc">Issue tracking & resolution</div></div>
        <div class="template-menu-item" onclick="createFromTemplate('meeting')"><div class="tmpl-name">üìù Meeting Notes</div><div class="tmpl-desc">Agenda, discussion, action items</div></div>
        <div class="template-menu-item" onclick="createFromTemplate('sales')"><div class="tmpl-name">üí∞ Sales Call</div><div class="tmpl-desc">Prospect info, needs, next steps</div></div>
      </div>
    </div>
    <button class="new-note-btn" id="newNoteBtn" onclick="createNote()">
      <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="7" y1="2" x2="7" y2="12"/><line x1="2" y1="7" x2="12" y2="7"/></svg>
      New Note
    </button>
  </div>

  <div class="content-area">
    <!-- Notes list panel -->
    <div class="notes-list" id="notesList">
      <div class="empty-state">
        <svg width="40" height="40" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="6" y="4" width="28" height="32" rx="3"/><line x1="12" y1="12" x2="28" y2="12"/><line x1="12" y1="18" x2="24" y2="18"/><line x1="12" y1="24" x2="26" y2="24"/></svg>
        <p>No notes yet</p>
        <span class="hint">Select a folder and create a note</span>
      </div>
    </div>

    <!-- Editor panel -->
    <div class="editor-area" id="editorArea">
      <div class="empty-state" id="editorEmpty">
        <svg width="48" height="48" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 8h24a4 4 0 0 1 4 4v24a4 4 0 0 1-4 4H12a4 4 0 0 1-4-4V12a4 4 0 0 1 4-4z"/><path d="M16 20h16M16 26h12M16 32h14"/></svg>
        <p>Select or create a note to begin</p>
        <span class="hint">Your notes auto-save and are timestamped<br>Hover any line to assign a task or use üé§ voice dictation<br>Ctrl+Z / Ctrl+Y for undo/redo</span>
      </div>
      <div id="editorContent" style="display:none; flex-direction:column; flex:1;">
        <div class="editor-header">
          <input class="editor-title-input" id="editorTitle" placeholder="Note title‚Ä¶" oninput="saveCurrentNote()">
          <div class="editor-meta">
            <span id="editorTimestamp"></span>
            <span class="tag" id="editorFolder"></span>
          </div>
          <div class="caller-input-row">
            <label>Caller / Contact:</label>
            <input class="caller-input" id="editorCaller" placeholder="Name or phone number‚Ä¶" oninput="saveCurrentNote()">
          </div>
          <div class="editor-tags-row" id="editorTagsRow"></div>
        </div>
        <div class="editor-body">
          <div class="note-lines-area" id="noteLinesArea"></div>
        </div>
      </div>
    </div>

    <!-- Dashboard panel (replaces editor+notes) -->
    <div class="dashboard-view" id="dashboardView"></div>
  </div>
</div>

<!-- Add Folder Modal -->
<div class="modal-overlay" id="addFolderModal">
  <div class="modal">
    <h2>Create New Folder</h2>
    <input type="text" id="newFolderName" placeholder="Folder name‚Ä¶" onkeydown="if(event.key==='Enter') addFolder()">
    <div class="modal-colors" id="colorPicker"></div>
    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeModals()">Cancel</button>
      <button class="btn-primary" onclick="addFolder()">Create</button>
    </div>
  </div>
</div>

<!-- Assign Task Modal -->
<div class="modal-overlay" id="taskModal">
  <div class="modal">
    <h2>Assign Follow-Up Task</h2>
    <div class="task-line-preview" id="taskLinePreview"></div>
    <label>Assigned To (Name)</label>
    <input type="text" id="taskAssignee" placeholder="e.g. John Smith">
    <label>Email Address</label>
    <input type="email" id="taskEmail" placeholder="e.g. john@company.com">
    <label>Due Date</label>
    <input type="date" id="taskDueDate">
    <label>Priority</label>
    <select id="taskPriority">
      <option value="normal">Normal</option>
      <option value="high">High</option>
      <option value="urgent">Urgent</option>
    </select>
    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeModals()">Cancel</button>
      <button class="btn-primary" onclick="saveTask()">Assign Task</button>
    </div>
  </div>
</div>

<script>
  // ‚îÄ‚îÄ Data ‚îÄ‚îÄ
  const COLORS = ['#6c8cff','#5ae0a0','#ff6b7a','#f0b865','#b08cff','#ff8c5a','#5ac8e0','#e06caa'];

  const NOTE_TAGS = [
    { id: 'follow-up', label: 'Follow-up', color: '#f0b865', bg: 'rgba(240,184,101,0.15)' },
    { id: 'urgent', label: 'Urgent', color: '#ff6b7a', bg: 'rgba(255,107,122,0.15)' },
    { id: 'waiting', label: 'Waiting', color: '#b08cff', bg: 'rgba(176,140,255,0.15)' },
    { id: 'completed', label: 'Completed', color: '#5ae0a0', bg: 'rgba(90,224,160,0.15)' },
    { id: 'important', label: 'Important', color: '#6c8cff', bg: 'rgba(108,140,255,0.15)' },
  ];

  const TEMPLATES = {
    client: { title: 'Client Call ‚Äî ', lines: [
      {text:'--- Client Information ---',task:null},{text:'Company: ',task:null},{text:'Contact: ',task:null},{text:'',task:null},
      {text:'--- Discussion Points ---',task:null},{text:'',task:null},{text:'',task:null},
      {text:'--- Key Takeaways ---',task:null},{text:'',task:null},
      {text:'--- Action Items ---',task:null},{text:'',task:null},{text:'',task:null}
    ]},
    support: { title: 'Support Ticket ‚Äî ', lines: [
      {text:'--- Issue Details ---',task:null},{text:'Reported by: ',task:null},{text:'Issue: ',task:null},{text:'Severity: ',task:null},{text:'',task:null},
      {text:'--- Troubleshooting Steps ---',task:null},{text:'1. ',task:null},{text:'2. ',task:null},{text:'3. ',task:null},{text:'',task:null},
      {text:'--- Resolution ---',task:null},{text:'',task:null}
    ]},
    meeting: { title: 'Meeting Notes ‚Äî ', lines: [
      {text:'--- Attendees ---',task:null},{text:'',task:null},{text:'',task:null},
      {text:'--- Agenda ---',task:null},{text:'1. ',task:null},{text:'2. ',task:null},{text:'3. ',task:null},{text:'',task:null},
      {text:'--- Discussion ---',task:null},{text:'',task:null},
      {text:'--- Action Items ---',task:null},{text:'',task:null}
    ]},
    sales: { title: 'Sales Call ‚Äî ', lines: [
      {text:'--- Prospect Info ---',task:null},{text:'Company: ',task:null},{text:'Contact: ',task:null},{text:'Budget: ',task:null},{text:'Timeline: ',task:null},{text:'',task:null},
      {text:'--- Needs / Pain Points ---',task:null},{text:'',task:null},
      {text:'--- Our Solution ---',task:null},{text:'',task:null},
      {text:'--- Next Steps ---',task:null},{text:'',task:null}
    ]}
  };

  const DEFAULT_FOLDERS = [
    {id:'finances',name:'Finances',color:'#5ae0a0'},{id:'software-dev',name:'Software Development',color:'#6c8cff'},
    {id:'operations',name:'Operations',color:'#f0b865'},{id:'clinic-locations',name:'Clinic Locations',color:'#b08cff'},
    {id:'facilities',name:'Facilities',color:'#ff8c5a'},{id:'monthly-rents',name:'Monthly Rents Due',color:'#ff6b7a'},
  ];

  let state=loadState(), activeFolder=null, activeNote=null, searchQuery='', selectedColor=COLORS[0];
  let dashboardActive=false, dashFilter='all', pendingTaskNoteId=null, pendingTaskLineIdx=null;
  let undoStack=[], redoStack=[], undoTimer=null, activeRecognition=null, activeRecordingIdx=null;

  function loadState(){try{const s=localStorage.getItem('callnotes_v2_state');if(s){const p=JSON.parse(s);if(p.notes)p.notes.forEach(n=>{if(!n.tags)n.tags=[];if(typeof n.pinned==='undefined')n.pinned=false;});return p;}}catch(e){}return{folders:DEFAULT_FOLDERS,notes:[]};}
  function saveState(){localStorage.setItem('callnotes_v2_state',JSON.stringify(state));showSaveIndicator();}
  function pushUndo(){undoStack.push(JSON.stringify(state));if(undoStack.length>50)undoStack.shift();redoStack=[];}
  function undo(){if(!undoStack.length)return;redoStack.push(JSON.stringify(state));state=JSON.parse(undoStack.pop());saveState();renderAll();}
  function redo(){if(!redoStack.length)return;undoStack.push(JSON.stringify(state));state=JSON.parse(redoStack.pop());saveState();renderAll();}
  function renderAll(){renderFolders();renderNotes();renderEditor();updateTopbar();}
  function showSaveIndicator(){const el=document.getElementById('saveIndicator');el.textContent='‚úì Saved';el.className='save-indicator show';clearTimeout(el._t);el._t=setTimeout(()=>el.classList.remove('show'),2000);}
  function genId(){return Date.now().toString(36)+Math.random().toString(36).substr(2,6);}
  function formatDate(ts){const d=new Date(ts);return d.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})+' ¬∑ '+d.toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',hour12:true});}
  function formatShortDate(ts){return new Date(ts).toLocaleDateString('en-US',{month:'short',day:'numeric'});}
  function formatDueDate(ds){return new Date(ds+'T00:00:00').toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});}
  function daysUntilDue(ds){return Math.ceil((new Date(ds+'T23:59:59')-new Date())/(1000*60*60*24));}

  // Theme
  function toggleTheme(){document.body.classList.toggle('light-theme');const l=document.body.classList.contains('light-theme');localStorage.setItem('callnotes_theme',l?'light':'dark');document.getElementById('themeToggle').textContent=l?'üåô Dark':'‚òÄÔ∏è Light';}
  (function(){const t=localStorage.getItem('callnotes_theme');if(t==='light'){document.body.classList.add('light-theme');document.getElementById('themeToggle').textContent='üåô Dark';}})();

  // Voice Recognition
  const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;
  let voiceFinalText='';
  function startVoice(idx){
    if(!SpeechRecognition){alert('Voice recognition not supported. Use Chrome or Edge.');return;}
    if(activeRecognition){activeRecognition.stop();activeRecognition=null;const pb=document.querySelector(`.line-mic-btn[data-idx="${activeRecordingIdx}"]`);if(pb)pb.classList.remove('recording');if(activeRecordingIdx===idx){activeRecordingIdx=null;return;}}
    const r=new SpeechRecognition();r.continuous=true;r.interimResults=true;r.lang='en-US';
    const note=state.notes.find(n=>n.id===activeNote);if(!note||!note.lines[idx])return;
    const startText=note.lines[idx].text;
    voiceFinalText='';
    const btn=document.querySelector(`.line-mic-btn[data-idx="${idx}"]`);if(btn)btn.classList.add('recording');
    activeRecognition=r;activeRecordingIdx=idx;
    r.onresult=(e)=>{let finalPart='';let interimPart='';for(let i=0;i<e.results.length;i++){if(e.results[i].isFinal){finalPart+=e.results[i][0].transcript;}else{interimPart+=e.results[i][0].transcript;}}if(finalPart)voiceFinalText+=(voiceFinalText?' ':'')+finalPart;const display=voiceFinalText+(interimPart?((voiceFinalText?' ':'')+interimPart):'');const li=document.querySelector(`.note-line-input[data-idx="${idx}"]`);if(li){li.value=startText+(startText&&display?' ':'')+display;note.lines[idx].text=li.value;note.updatedAt=Date.now();if(idx===note.lines.length-1&&li.value!=='')note.lines.push({text:'',task:null});saveState();}};
    r.onerror=(e)=>{if(e.error!=='aborted')console.log('Speech error:',e.error);if(btn)btn.classList.remove('recording');activeRecognition=null;activeRecordingIdx=null;};
    r.onend=()=>{if(btn)btn.classList.remove('recording');activeRecognition=null;activeRecordingIdx=null;renderNotes();};
    r.start();
  }

  // Global Search
  function onGlobalSearch(){
    const q=document.getElementById('searchInput').value.trim().toLowerCase();
    const res=document.getElementById('globalSearchResults');
    if(!q){res.classList.remove('show');searchQuery='';if(activeFolder&&!dashboardActive)renderNotes();return;}
    searchQuery=q;if(activeFolder&&!dashboardActive)renderNotes();
    const matches=[];
    state.notes.forEach(note=>{
      const tm=(note.title||'').toLowerCase().includes(q);const cm=(note.caller||'').toLowerCase().includes(q);
      const lm=(note.lines||[]).filter(l=>l.text.toLowerCase().includes(q));
      if(tm||cm||lm.length>0){const f=state.folders.find(f=>f.id===note.folderId);const sn=lm.length>0?lm[0].text.substring(0,100):(note.lines||[]).map(l=>l.text).join(' ').substring(0,100);matches.push({note,folder:f,snippet:sn});}
    });
    if(!matches.length)res.innerHTML='<div style="padding:14px;text-align:center;color:var(--text-muted);font-size:13px">No results found</div>';
    else res.innerHTML=matches.slice(0,10).map(m=>`<div class="search-result-item" onmousedown="jumpToSearchResult('${m.note.id}')"><div class="search-result-title">${hlText(m.note.title||'Untitled',q)}</div><div class="search-result-snippet">${hlText(m.snippet,q)}</div><div class="search-result-meta"><span style="color:var(--accent)">${m.folder?escHtml(m.folder.name):'?'}</span> ¬∑ ${formatShortDate(m.note.updatedAt)}</div></div>`).join('');
    res.classList.add('show');
  }
  function hlText(t,q){if(!t||!q)return escHtml(t||'');const e=escHtml(t);return e.replace(new RegExp(`(${q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`,'gi'),'<span class="search-highlight">$1</span>');}
  function hideGlobalSearch(){document.getElementById('globalSearchResults').classList.remove('show');}
  function jumpToSearchResult(nid){hideGlobalSearch();const n=state.notes.find(x=>x.id===nid);if(!n)return;closeDashboard();activeFolder=n.folderId;activeNote=nid;searchQuery='';document.getElementById('searchInput').value='';renderAll();}

  // Tags
  function renderEditorTags(){const note=state.notes.find(n=>n.id===activeNote);const row=document.getElementById('editorTagsRow');if(!note||!row)return;const nt=note.tags||[];row.innerHTML=NOTE_TAGS.map(t=>{const a=nt.includes(t.id);return`<span class="tag-chip ${a?'active':''}" style="background:${a?t.bg:'transparent'};color:${t.color};${a?'':'opacity:0.5;'}" onclick="toggleNoteTag('${t.id}')" title="${a?'Remove':'Add'} tag">${t.label}</span>`;}).join('');}
  function toggleNoteTag(tid){const note=state.notes.find(n=>n.id===activeNote);if(!note)return;if(!note.tags)note.tags=[];pushUndo();const i=note.tags.indexOf(tid);if(i>=0)note.tags.splice(i,1);else note.tags.push(tid);note.updatedAt=Date.now();saveState();renderEditorTags();renderNotes();}

  // Pin
  function togglePin(nid,e){if(e)e.stopPropagation();pushUndo();const n=state.notes.find(x=>x.id===nid);if(!n)return;n.pinned=!n.pinned;n.updatedAt=Date.now();saveState();renderNotes();}

  // Templates
  function toggleTemplateMenu(){document.getElementById('templateMenu').classList.toggle('show');}
  function createFromTemplate(key){document.getElementById('templateMenu').classList.remove('show');if(!activeFolder){alert('Please select a folder first.');return;}const tmpl=TEMPLATES[key];if(!tmpl)return;pushUndo();const now=Date.now();const note={id:genId(),folderId:activeFolder,title:tmpl.title,caller:'',lines:JSON.parse(JSON.stringify(tmpl.lines)),tags:[],pinned:false,createdAt:now,updatedAt:now};state.notes.push(note);activeNote=note.id;saveState();renderAll();document.getElementById('editorTitle').focus();document.getElementById('editorTitle').setSelectionRange(tmpl.title.length,tmpl.title.length);}

  function getAllTasks(){const t=[];state.notes.forEach(n=>{if(!n.lines)return;n.lines.forEach((l,i)=>{if(l.task)t.push({...l.task,lineText:l.text,noteId:n.id,noteTitle:n.title||'Untitled',folderId:n.folderId,lineIdx:i});});});return t;}
  function getOpenTaskCount(){return getAllTasks().filter(t=>!t.completed).length;}

  // ‚îÄ‚îÄ Render ‚îÄ‚îÄ
  function renderFolders(){
    const list=document.getElementById('folderList');
    list.innerHTML=state.folders.map(f=>{const c=state.notes.filter(n=>n.folderId===f.id).length;const a=activeFolder===f.id&&!dashboardActive;return`<div class="folder-item ${a?'active':''}" onclick="selectFolder('${f.id}')"><span class="dot" style="background:${f.color}"></span>${escHtml(f.name)}<span class="count">${c}</span><button class="delete-folder" onclick="event.stopPropagation();deleteFolder('${f.id}')" title="Delete folder">√ó</button></div>`;}).join('');
    document.getElementById('totalNotesCount').textContent=`${state.notes.length} note${state.notes.length!==1?'s':''}`;
    const oc=getOpenTaskCount();document.getElementById('dashBadge').textContent=oc;document.getElementById('dashBadge').style.display=oc>0?'':'none';document.getElementById('dashboardBtn').classList.toggle('active',dashboardActive);
  }

  function renderNotes(){
    const list=document.getElementById('notesList');
    if(!activeFolder){list.innerHTML='<div class="empty-state"><svg width="40" height="40" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="6" y="4" width="28" height="32" rx="3"/><line x1="12" y1="12" x2="28" y2="12"/></svg><p>Select a folder to view notes</p></div>';return;}
    let notes=state.notes.filter(n=>n.folderId===activeFolder).sort((a,b)=>{if(a.pinned&&!b.pinned)return -1;if(!a.pinned&&b.pinned)return 1;return b.updatedAt-a.updatedAt;});
    if(searchQuery){const q=searchQuery.toLowerCase();notes=notes.filter(n=>n.title.toLowerCase().includes(q)||(n.lines||[]).some(l=>l.text.toLowerCase().includes(q))||(n.caller||'').toLowerCase().includes(q));}
    if(!notes.length){list.innerHTML=`<div class="empty-state"><p>${searchQuery?'No matching notes':'No notes in this folder'}</p><span class="hint">${searchQuery?'Try a different search':'Click "New Note" to create one'}</span></div>`;return;}
    list.innerHTML=notes.map(n=>{const a=activeNote===n.id;const bt=(n.lines||[]).map(l=>l.text).join(' ');const sn=bt.substring(0,80)||'Empty note‚Ä¶';const cl=n.caller?`üìû ${escHtml(n.caller)}`:'';const tc=(n.lines||[]).filter(l=>l.task&&!l.task.completed).length;
    const tags=(n.tags||[]).map(tid=>{const t=NOTE_TAGS.find(x=>x.id===tid);return t?`<span class="note-tag-badge" style="background:${t.bg};color:${t.color}">${t.label}</span>`:'';}).join('');
    return`<div class="note-preview ${a?'active':''}" onclick="selectNote('${n.id}')"><div class="note-preview-title">${n.pinned?'<span class="pin-star">‚≠ê</span>':''}<span style="overflow:hidden;text-overflow:ellipsis">${escHtml(n.title||'Untitled Note')}</span></div><div class="note-preview-snippet">${escHtml(sn)}</div><div class="note-preview-meta"><span>${formatShortDate(n.updatedAt)}</span>${cl?`<span>${cl}</span>`:''}${tc>0?`<span class="note-preview-tasks">‚ö° ${tc} task${tc>1?'s':''}</span>`:''}${tags}</div><div class="note-actions-row"><button class="note-action-sm pin-btn ${n.pinned?'pinned':''}" onclick="togglePin('${n.id}',event)" title="${n.pinned?'Unpin':'Pin'}">${n.pinned?'‚≠ê':'‚òÜ'}</button><button class="note-action-sm del-btn" onclick="event.stopPropagation();deleteNote('${n.id}')" title="Delete">√ó</button></div></div>`;}).join('');
  }

  function renderEditor(){
    const empty=document.getElementById('editorEmpty'),content=document.getElementById('editorContent');
    if(!activeNote){empty.style.display='flex';content.style.display='none';return;}
    const note=state.notes.find(n=>n.id===activeNote);if(!note)return;
    empty.style.display='none';content.style.display='flex';
    document.getElementById('editorTitle').value=note.title;document.getElementById('editorCaller').value=note.caller||'';document.getElementById('editorTimestamp').textContent=formatDate(note.createdAt);
    const f=state.folders.find(x=>x.id===note.folderId);const ft=document.getElementById('editorFolder');if(f){ft.textContent=f.name;ft.style.display='';}else ft.style.display='none';
    renderNoteLines(note);renderEditorTags();
  }

  function renderNoteLines(note){
    const area=document.getElementById('noteLinesArea');if(!note.lines)note.lines=[{text:'',task:null}];
    if(!note.lines.length||note.lines[note.lines.length-1].text!=='')note.lines.push({text:'',task:null});
    area.innerHTML=note.lines.map((line,idx)=>{const ht=!!line.task;const th=ht?renderLineTaskIndicator(line.task,note.id,idx):'';
    return`<div class="note-line" data-idx="${idx}"><span class="note-line-number">${idx+1}</span><input class="note-line-input ${ht?'has-task':''}" value="${escAttr(line.text)}" placeholder="${idx===0?'Start typing or click üé§ to dictate‚Ä¶':''}" oninput="onLineInput(${idx},this)" onkeydown="onLineKeydown(event,${idx})" data-idx="${idx}"><button class="line-mic-btn" data-idx="${idx}" onclick="startVoice(${idx})" title="Voice dictation">üé§</button><button class="line-task-btn ${ht?'has-task':''}" onclick="openTaskModal('${note.id}',${idx})" title="${ht?'Edit task':'Assign follow-up'}">${ht?'‚ö°':'+ Task'}</button></div>${th?`<div style="padding-left:38px;padding-right:12px;padding-bottom:4px">${th}</div>`:''}`;}).join('');
  }

  function renderLineTaskIndicator(task,nid,li){
    const d=daysUntilDue(task.dueDate);let dl=formatDueDate(task.dueDate),dc='';
    if(task.completed){dl='‚úì Completed';dc='color:var(--green)';}else if(d<0){dl=`OVERDUE (${Math.abs(d)}d)`;dc='color:var(--red);font-weight:600';}else if(d<=3){dl=`Due in ${d}d`;dc='color:var(--amber)';}
    const eh=task.email?buildEmailLink(task,nid,li):'';const cs=task.completed?'opacity:0.5;':'';
    return`<div class="line-task-indicator" style="${cs}"><span class="assignee">${escHtml(task.assignee)}</span><span class="due" style="${dc}">${dl}</span>${task.priority==='urgent'?'<span style="color:var(--red)">üî¥</span>':task.priority==='high'?'<span style="color:var(--amber)">üü°</span>':''}${eh?`<a class="email-link" href="${eh}" title="Send email">‚úâ</a>`:''}${!task.completed?`<span class="line-task-complete" onclick="toggleTaskComplete('${nid}',${li})" title="Mark complete">‚òê</span>`:`<span class="line-task-complete" onclick="toggleTaskComplete('${nid}',${li})" title="Mark incomplete" style="color:var(--green)">‚òë</span>`}<span class="remove-task" onclick="removeTask('${nid}',${li})" title="Remove task">√ó</span></div>`;
  }

  function buildEmailLink(task,nid,li){const note=state.notes.find(n=>n.id===nid);if(!note)return'';const f=state.folders.find(x=>x.id===note.folderId);const lt=note.lines[li]?note.lines[li].text:'';const s=encodeURIComponent(`Follow-Up: ${lt.substring(0,60)||note.title||'Action Required'}`);const b=encodeURIComponent(`Hi ${task.assignee},\n\nFollow-up task from a call note.\n\nüìã Task: ${lt}\nüìÅ Folder: ${f?f.name:''}\nüìù Note: ${note.title||'Untitled'}\nüìû Call with: ${note.caller||'N/A'}\nüìÖ Due: ${formatDueDate(task.dueDate)}\n‚ö° Priority: ${task.priority}\n\nThank you!`);return`mailto:${encodeURIComponent(task.email)}?subject=${s}&body=${b}`;}

  // Dashboard
  function renderDashboard(){const v=document.getElementById('dashboardView');const tasks=getAllTasks();const ov=tasks.filter(t=>!t.completed&&daysUntilDue(t.dueDate)<0);const ds=tasks.filter(t=>!t.completed&&daysUntilDue(t.dueDate)>=0&&daysUntilDue(t.dueDate)<=3);const up=tasks.filter(t=>!t.completed&&daysUntilDue(t.dueDate)>3);const co=tasks.filter(t=>t.completed);let ft;if(dashFilter==='overdue')ft=ov;else if(dashFilter==='due-soon')ft=ds;else if(dashFilter==='upcoming')ft=up;else if(dashFilter==='completed')ft=co;else ft=[...ov,...ds,...up,...co];ft.sort((a,b)=>{if(a.completed!==b.completed)return a.completed?1:-1;return new Date(a.dueDate)-new Date(b.dueDate);});
  v.innerHTML=`<div class="dash-header"><h2>Task Dashboard</h2><p>Follow-up tasks from your phone call notes</p></div><div class="dash-stats"><div class="dash-stat-card overdue"><div class="label">Overdue</div><div class="value">${ov.length}</div></div><div class="dash-stat-card due-soon"><div class="label">Due Soon</div><div class="value">${ds.length}</div></div><div class="dash-stat-card upcoming"><div class="label">Upcoming</div><div class="value">${up.length}</div></div><div class="dash-stat-card completed"><div class="label">Completed</div><div class="value">${co.length}</div></div></div><div class="dash-filter-row"><button class="dash-filter-btn ${dashFilter==='all'?'active':''}" onclick="setDashFilter('all')">All (${tasks.length})</button><button class="dash-filter-btn ${dashFilter==='overdue'?'active':''}" onclick="setDashFilter('overdue')">üî¥ Overdue (${ov.length})</button><button class="dash-filter-btn ${dashFilter==='due-soon'?'active':''}" onclick="setDashFilter('due-soon')">üü° Due Soon (${ds.length})</button><button class="dash-filter-btn ${dashFilter==='upcoming'?'active':''}" onclick="setDashFilter('upcoming')">üîµ Upcoming (${up.length})</button><button class="dash-filter-btn ${dashFilter==='completed'?'active':''}" onclick="setDashFilter('completed')">‚úÖ Completed (${co.length})</button></div>${!ft.length?`<div class="no-tasks-msg">${dashFilter==='all'?'No tasks yet. Hover any line to assign a follow-up task.':'No tasks in this category.'}</div>`:ft.map(t=>renderTaskCard(t)).join('')}`;}

  function renderTaskCard(task){const d=daysUntilDue(task.dueDate);let sc='upcoming-task',dt=formatDueDate(task.dueDate),dc='';if(task.completed){sc='completed-task';dt='Completed';}else if(d<0){sc='overdue';dt=`OVERDUE by ${Math.abs(d)}d`;dc='overdue-text';}else if(d<=3){sc='due-soon';dt=d===0?'Due TODAY':`Due in ${d}d`;dc='due-soon-text';}const f=state.folders.find(x=>x.id===task.folderId);const eh=task.email?buildEmailLink(task,task.noteId,task.lineIdx):'';
  return`<div class="task-card ${sc}"><div class="task-check ${task.completed?'done':''}" onclick="toggleTaskFromDash('${task.noteId}',${task.lineIdx})"></div><div class="task-info"><div class="task-text ${task.completed?'done-text':''}">${escHtml(task.lineText||'No description')}</div><div class="task-meta-row"><span class="task-assignee">üë§ ${escHtml(task.assignee)}</span><span class="task-due ${dc}">üìÖ ${dt}</span>${task.priority!=='normal'?`<span>${task.priority==='urgent'?'üî¥ Urgent':'üü° High'}</span>`:''}<span class="task-from-note" onclick="jumpToNote('${task.noteId}')">üìù ${escHtml(task.noteTitle)}${f?' ‚Äî '+escHtml(f.name):''}</span></div></div><div class="task-actions">${eh?`<a class="task-action-btn email-btn" href="${eh}">‚úâ Email</a>`:''}<button class="task-action-btn" onclick="jumpToNote('${task.noteId}')">‚Üí Note</button></div></div>`;}

  function setDashFilter(f){dashFilter=f;renderDashboard();}
  function openDashboard(){dashboardActive=true;activeNote=null;document.getElementById('notesList').style.display='none';document.getElementById('editorArea').style.display='none';document.getElementById('dashboardView').style.display='block';document.getElementById('dashboardView').classList.add('active');document.getElementById('newNoteBtn').style.display='none';document.getElementById('topbarDot').style.background='var(--amber)';document.getElementById('topbarDot').style.display='';document.getElementById('topbarTitle').textContent='Task Dashboard';renderFolders();renderDashboard();}
  function closeDashboard(){dashboardActive=false;document.getElementById('notesList').style.display='';document.getElementById('editorArea').style.display='';document.getElementById('dashboardView').style.display='none';document.getElementById('dashboardView').classList.remove('active');document.getElementById('newNoteBtn').style.display='';}
  function jumpToNote(nid){const n=state.notes.find(x=>x.id===nid);if(!n)return;closeDashboard();activeFolder=n.folderId;activeNote=nid;renderAll();}
  function updateTopbar(){if(dashboardActive)return;const dot=document.getElementById('topbarDot'),title=document.getElementById('topbarTitle');if(activeFolder){const f=state.folders.find(x=>x.id===activeFolder);if(f){dot.style.background=f.color;dot.style.display='';title.textContent=f.name;return;}}dot.style.display='none';title.textContent='Select a folder';}

  // Line editing
  function onLineInput(idx,el){const note=state.notes.find(n=>n.id===activeNote);if(!note||!note.lines[idx])return;clearTimeout(undoTimer);undoTimer=setTimeout(()=>pushUndo(),500);note.lines[idx].text=el.value;if(idx===note.lines.length-1&&el.value!=='')note.lines.push({text:'',task:null});note.updatedAt=Date.now();saveState();renderNotes();}
  function onLineKeydown(e,idx){const note=state.notes.find(n=>n.id===activeNote);if(!note)return;if(e.key==='Enter'){e.preventDefault();pushUndo();note.lines.splice(idx+1,0,{text:'',task:null});note.updatedAt=Date.now();saveState();renderNoteLines(note);setTimeout(()=>{const inp=document.querySelectorAll('.note-line-input');if(inp[idx+1])inp[idx+1].focus();},30);}if(e.key==='Backspace'&&note.lines[idx].text===''&&note.lines.length>1){e.preventDefault();if(note.lines[idx].task)return;pushUndo();note.lines.splice(idx,1);note.updatedAt=Date.now();saveState();renderNoteLines(note);setTimeout(()=>{const inp=document.querySelectorAll('.note-line-input');const fi=Math.max(0,idx-1);if(inp[fi]){inp[fi].focus();inp[fi].setSelectionRange(inp[fi].value.length,inp[fi].value.length);}},30);}if(e.key==='ArrowDown'){const inp=document.querySelectorAll('.note-line-input');if(inp[idx+1]){e.preventDefault();inp[idx+1].focus();}}if(e.key==='ArrowUp'){const inp=document.querySelectorAll('.note-line-input');if(inp[idx-1]){e.preventDefault();inp[idx-1].focus();}}}

  // Tasks
  function openTaskModal(nid,li){const note=state.notes.find(n=>n.id===nid);if(!note||!note.lines[li])return;pendingTaskNoteId=nid;pendingTaskLineIdx=li;document.getElementById('taskLinePreview').textContent=note.lines[li].text||'(empty line)';if(note.lines[li].task){const t=note.lines[li].task;document.getElementById('taskAssignee').value=t.assignee||'';document.getElementById('taskEmail').value=t.email||'';document.getElementById('taskDueDate').value=t.dueDate||'';document.getElementById('taskPriority').value=t.priority||'normal';}else{document.getElementById('taskAssignee').value='';document.getElementById('taskEmail').value='';const d=new Date();d.setDate(d.getDate()+3);document.getElementById('taskDueDate').value=d.toISOString().split('T')[0];document.getElementById('taskPriority').value='normal';}document.getElementById('taskModal').classList.add('show');setTimeout(()=>document.getElementById('taskAssignee').focus(),100);}
  function saveTask(){const a=document.getElementById('taskAssignee').value.trim(),em=document.getElementById('taskEmail').value.trim(),dd=document.getElementById('taskDueDate').value,pr=document.getElementById('taskPriority').value;if(!a){alert('Please enter an assignee.');return;}if(!dd){alert('Please select a due date.');return;}const note=state.notes.find(n=>n.id===pendingTaskNoteId);if(!note||!note.lines[pendingTaskLineIdx])return;pushUndo();note.lines[pendingTaskLineIdx].task={assignee:a,email:em,dueDate:dd,priority:pr,completed:false,createdAt:Date.now()};note.updatedAt=Date.now();saveState();closeModals();renderNoteLines(note);renderNotes();renderFolders();}
  function removeTask(nid,li){const note=state.notes.find(n=>n.id===nid);if(!note||!note.lines[li])return;if(!confirm('Remove this task?'))return;pushUndo();note.lines[li].task=null;note.updatedAt=Date.now();saveState();renderNoteLines(note);renderNotes();renderFolders();}
  function toggleTaskComplete(nid,li){const note=state.notes.find(n=>n.id===nid);if(!note||!note.lines[li]||!note.lines[li].task)return;pushUndo();note.lines[li].task.completed=!note.lines[li].task.completed;note.updatedAt=Date.now();saveState();renderNoteLines(note);renderFolders();}
  function toggleTaskFromDash(nid,li){toggleTaskComplete(nid,li);renderDashboard();}

  // Folder/Note
  function selectFolder(id){closeDashboard();activeFolder=id;activeNote=null;searchQuery='';document.getElementById('searchInput').value='';renderAll();}
  function selectNote(id){activeNote=id;renderNotes();renderEditor();}
  function createNote(){if(!activeFolder){alert('Please select a folder first.');return;}pushUndo();const now=Date.now();const note={id:genId(),folderId:activeFolder,title:'',caller:'',lines:[{text:'',task:null}],tags:[],pinned:false,createdAt:now,updatedAt:now};state.notes.push(note);activeNote=note.id;saveState();renderAll();document.getElementById('editorTitle').focus();}
  function saveCurrentNote(){if(!activeNote)return;const note=state.notes.find(n=>n.id===activeNote);if(!note)return;note.title=document.getElementById('editorTitle').value;note.caller=document.getElementById('editorCaller').value;note.updatedAt=Date.now();saveState();renderNotes();renderFolders();}
  function deleteNote(id){if(!confirm('Delete this note and all its tasks?'))return;pushUndo();state.notes=state.notes.filter(n=>n.id!==id);if(activeNote===id)activeNote=null;saveState();renderAll();}
  function deleteFolder(id){const nc=state.notes.filter(n=>n.folderId===id).length;if(!confirm(nc>0?`Delete this folder and its ${nc} note(s)?`:'Delete this folder?'))return;pushUndo();state.folders=state.folders.filter(f=>f.id!==id);state.notes=state.notes.filter(n=>n.folderId!==id);if(activeFolder===id){activeFolder=null;activeNote=null;}saveState();renderAll();}

  // Modals
  function openAddFolderModal(){document.getElementById('addFolderModal').classList.add('show');document.getElementById('newFolderName').value='';selectedColor=COLORS[0];renderColorPicker();setTimeout(()=>document.getElementById('newFolderName').focus(),100);}
  function closeModals(){document.getElementById('addFolderModal').classList.remove('show');document.getElementById('taskModal').classList.remove('show');}
  function renderColorPicker(){document.getElementById('colorPicker').innerHTML=COLORS.map(c=>`<div class="color-opt ${selectedColor===c?'selected':''}" style="background:${c}" onclick="selectedColor='${c}';renderColorPicker()"></div>`).join('');}
  function addFolder(){const name=document.getElementById('newFolderName').value.trim();if(!name)return;pushUndo();state.folders.push({id:genId(),name,color:selectedColor});saveState();renderFolders();closeModals();}

  // Backup/Restore
  function backupData(){const bk={version:'bc-callnotes-v2',exportedAt:new Date().toISOString(),folders:state.folders,notes:state.notes};const j=JSON.stringify(bk,null,2);const b=new Blob([j],{type:'application/json'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=`BC-CallNotes-Backup_${new Date().toISOString().slice(0,10)}.json`;a.click();URL.revokeObjectURL(u);localStorage.setItem('callnotes_last_backup',Date.now().toString());updateBackupStatus();}
  function restoreData(event){const file=event.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=function(e){try{const data=JSON.parse(e.target.result);if(!data.folders||!data.notes){alert('Invalid backup file.');return;}const mode=confirm(`Found ${data.folders.length} folders and ${data.notes.length} notes.\n\nOK = REPLACE all data\nCancel = MERGE`);pushUndo();if(mode){state.folders=data.folders;state.notes=data.notes;}else{const ef=state.folders.map(f=>f.id);data.folders.forEach(f=>{if(!ef.includes(f.id))state.folders.push(f);});const en=state.notes.map(n=>n.id);data.notes.forEach(n=>{if(!en.includes(n.id))state.notes.push(n);});}state.notes.forEach(n=>{if(!n.tags)n.tags=[];if(typeof n.pinned==='undefined')n.pinned=false;});activeFolder=null;activeNote=null;saveState();renderAll();updateBackupStatus();alert('‚úÖ Data restored successfully!');}catch(err){alert('Error reading backup.\n\n'+err.message);}};reader.readAsText(file);event.target.value='';}
  function updateBackupStatus(){const el=document.getElementById('backupStatus');const lb=localStorage.getItem('callnotes_last_backup');if(!lb){el.innerHTML='<span class="backup-warn" onclick="backupData()">‚ö† No backup yet ‚Äî click to backup now</span>';return;}const lt=parseInt(lb);const ds=Math.floor((Date.now()-lt)/(1e3*60*60*24));const d=new Date(lt).toLocaleDateString('en-US',{month:'short',day:'numeric'});if(ds>=7)el.innerHTML=`<span class="backup-warn" onclick="backupData()">‚ö† Last backup: ${d} (${ds}d ago) ‚Äî click to backup</span>`;else el.innerHTML=`<span class="backup-ok">‚úì Backed up: ${d}</span>`;}

  // Export
  function exportAllNotes(){let t='CALLNOTES ‚Äî EXPORTED NOTES\n'+'='.repeat(50)+'\n\n';state.folders.forEach(f=>{const fn=state.notes.filter(n=>n.folderId===f.id).sort((a,b)=>b.createdAt-a.createdAt);if(!fn.length)return;t+=`\nüìÅ ${f.name}\n`+'‚îÄ'.repeat(40)+'\n';fn.forEach(n=>{t+=`\n  üìù ${n.title||'Untitled'}\n  Created: ${formatDate(n.createdAt)}\n`;if(n.caller)t+=`  Caller: ${n.caller}\n`;if(n.tags&&n.tags.length)t+=`  Tags: ${n.tags.join(', ')}\n`;t+=`  ${'‚îÄ'.repeat(30)}\n`;(n.lines||[]).forEach(l=>{if(!l.text&&!l.task)return;t+=`  ${l.text}\n`;if(l.task)t+=`    ‚ö° TASK ‚Üí ${l.task.assignee}${l.task.email?' ('+l.task.email+')':''} | Due: ${formatDueDate(l.task.dueDate)} | ${l.task.priority} | ${l.task.completed?'DONE':'OPEN'}\n`;});t+='\n';});});const bl=new Blob([t],{type:'text/plain'});const u=URL.createObjectURL(bl);const a=document.createElement('a');a.href=u;a.download=`callnotes_export_${new Date().toISOString().slice(0,10)}.txt`;a.click();URL.revokeObjectURL(u);}

  function escHtml(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML;}
  function escAttr(s){return s.replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

  // Keyboard
  document.addEventListener('keydown',(e)=>{if((e.ctrlKey||e.metaKey)&&e.key==='n'){e.preventDefault();createNote();}if((e.ctrlKey||e.metaKey)&&e.key==='z'&&!e.shiftKey){e.preventDefault();undo();}if((e.ctrlKey||e.metaKey)&&(e.key==='y'||(e.key==='z'&&e.shiftKey))){e.preventDefault();redo();}if(e.key==='Escape'){closeModals();hideGlobalSearch();document.getElementById('templateMenu').classList.remove('show');}});
  document.addEventListener('click',(e)=>{if(!e.target.closest('.template-dropdown'))document.getElementById('templateMenu').classList.remove('show');});

  // Init
  renderAll();updateBackupStatus();
  (function(){const lb=localStorage.getItem('callnotes_last_backup');if(state.notes.length>0&&(!lb||(Date.now()-parseInt(lb))>7*24*60*60*1000)){setTimeout(()=>{if(confirm('üîî It\'s been a while since your last backup.\n\nBackup now?'))backupData();},3000);}})();

  // ‚îÄ‚îÄ Mobile Navigation ‚îÄ‚îÄ
  let mobileEditorActive = false;

  function toggleMobileSidebar() {
    const sidebar = document.querySelector('.sidebar');
    const overlay = document.getElementById('sidebarOverlay');
    sidebar.classList.toggle('open');
    overlay.classList.toggle('show');
  }

  function mobileGoBack() {
    mobileEditorActive = false;
    activeNote = null;
    updateMobileView();
    renderNotes();
    renderEditor();
  }

  function updateMobileView() {
    const isMobile = window.innerWidth <= 768;
    if (!isMobile) {
      // Desktop: ensure everything visible
      document.getElementById('notesList').classList.remove('mobile-hidden');
      document.getElementById('editorArea').classList.remove('mobile-hidden');
      document.getElementById('mobileBackBtn').classList.remove('show');
      return;
    }

    const notesList = document.getElementById('notesList');
    const editorArea = document.getElementById('editorArea');
    const backBtn = document.getElementById('mobileBackBtn');

    if (mobileEditorActive && activeNote) {
      notesList.classList.add('mobile-hidden');
      editorArea.classList.remove('mobile-hidden');
      backBtn.classList.add('show');
    } else {
      notesList.classList.remove('mobile-hidden');
      editorArea.classList.add('mobile-hidden');
      backBtn.classList.remove('show');
    }
  }

  // Override selectNote for mobile
  const _origSelectNote = selectNote;
  selectNote = function(id) {
    _origSelectNote(id);
    if (window.innerWidth <= 768) {
      mobileEditorActive = true;
      updateMobileView();
    }
  };

  // Override selectFolder for mobile - close sidebar
  const _origSelectFolder = selectFolder;
  selectFolder = function(id) {
    _origSelectFolder(id);
    if (window.innerWidth <= 768) {
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      sidebar.classList.remove('open');
      overlay.classList.remove('show');
      mobileEditorActive = false;
      updateMobileView();
    }
  };

  // Override openDashboard for mobile - close sidebar
  const _origOpenDashboard = openDashboard;
  openDashboard = function() {
    _origOpenDashboard();
    if (window.innerWidth <= 768) {
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      sidebar.classList.remove('open');
      overlay.classList.remove('show');
    }
  };

  // Override jumpToNote for mobile
  const _origJumpToNote = jumpToNote;
  jumpToNote = function(nid) {
    _origJumpToNote(nid);
    if (window.innerWidth <= 768) {
      mobileEditorActive = true;
      updateMobileView();
    }
  };

  // Override jumpToSearchResult for mobile
  const _origJumpSearch = jumpToSearchResult;
  jumpToSearchResult = function(nid) {
    _origJumpSearch(nid);
    if (window.innerWidth <= 768) {
      mobileEditorActive = true;
      updateMobileView();
    }
  };

  // Listen for resize
  window.addEventListener('resize', updateMobileView);

  // Initial mobile setup
  updateMobileView();
</script>
</body>
</html>
